trigger:
  branches:
    include:
    - main  # Only run on changes to main
pr:
  branches:
    exclude:
    - '*' # Don't ever run when a PR is created

variables:
- name: workingDirectory
  value: $(System.DefaultWorkingDirectory)/infrastructure

stages:
- template: templates/deploy-template.yaml
  parameters:
    stageName: DeployDevelopment
    environment: aml-bicep-development
    variableGroupName: AzureML-Bicep-Deploy-Development
    workingDirectory: ${{ variables.workingDirectory }}
    # resourceGroupName: ${{ variables.resourceGroupName }}
    # workingDirectory: ${{ variables.workingDirectory }}
    # appInsightsName: ${{ variables.appInsightsName }}
    # computeInstanceName: ${{ variables.computeInstanceName }}
    # computeInstanceSku: ${{ variables.computeInstanceSku }}
    # containerRegistryName: ${{ variables.containerRegistryName }}
    # createMlCluster: ${{ variables.createMlCluster }}
    # createMlComputeInstance: ${{ variables.createMlComputeInstance }}
    # keyVaultAccessPolicyTargetObjectId: ${{ variables.keyVaultAccessPolicyTargetObjectId }}
    # keyVaultName: ${{ variables.keyVaultName }}
    # mlClusterMaxNodeCount: ${{ variables.mlClusterMaxNodeCount }}
    # mlClusterMinNodeCount: ${{ variables.mlClusterMinNodeCount }}
    # mlClusterName: ${{ variables.mlClusterName }}
    # mlClusterSku: ${{ variables.mlClusterSku }}
    # mlComputeAssignedUser: ${{ variables.mlComputeAssignedUser }}
    # mlWorkspaceName: ${{ variables.mlWorkspaceName }}
    # storageAccountName: ${{ variables.storageAccountName }}
